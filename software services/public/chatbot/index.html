<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BLSC AI - Smart Chatbot</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:#0a0a0a;color:#fff;min-height:100vh;display:flex}

/* API Key Modal */
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
.modal.show{display:flex}
.modal-content{background:#1a1a1a;border:1px solid #333;border-radius:16px;padding:32px;max-width:500px;width:90%}
.modal-content h2{margin-bottom:8px;display:flex;align-items:center;gap:10px}
.modal-content h2 i{color:#3fb950}
.modal-content p{color:#888;margin-bottom:20px;font-size:14px}
.modal-content input{width:100%;padding:14px 16px;background:#0a0a0a;border:1px solid #333;border-radius:8px;color:#fff;font-size:14px;margin-bottom:12px}
.modal-content input:focus{outline:none;border-color:#3fb950}
.modal-content .btn-row{display:flex;gap:12px}
.modal-content button{flex:1;padding:12px;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:all 0.2s}
.modal-content .btn-primary{background:#3fb950;color:#000}
.modal-content .btn-primary:hover{background:#4cc95f}
.modal-content .btn-secondary{background:#333;color:#fff}
.modal-content .btn-secondary:hover{background:#444}
.modal-content .help-text{font-size:12px;color:#666;margin-top:16px}
.modal-content .help-text a{color:#3fb950}

/* Sidebar */
.sidebar{width:260px;background:#111;border-right:1px solid #222;display:flex;flex-direction:column;height:100vh;position:fixed;left:0;top:0;transition:transform 0.3s}
.sidebar-header{padding:16px;border-bottom:1px solid #222}
.new-chat-btn{width:100%;padding:12px 16px;background:transparent;border:1px solid #444;border-radius:8px;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all 0.2s}
.new-chat-btn:hover{background:#222}
.api-status{padding:12px 16px;font-size:12px;display:flex;align-items:center;gap:8px;cursor:pointer;border-radius:8px;margin-top:8px;transition:all 0.2s}
.api-status:hover{background:#222}
.api-status.connected{color:#3fb950}
.api-status.disconnected{color:#ff6b6b}
.api-status i{font-size:8px}
.chat-history{flex:1;overflow-y:auto;padding:8px}
.chat-item{padding:12px 16px;border-radius:8px;cursor:pointer;font-size:14px;color:#ccc;display:flex;align-items:center;gap:10px;margin-bottom:4px;transition:all 0.2s}
.chat-item:hover,.chat-item.active{background:#222;color:#fff}
.chat-item i{font-size:12px}
.sidebar-footer{padding:16px;border-top:1px solid #222}
.sidebar-footer a{display:flex;align-items:center;gap:10px;color:#888;text-decoration:none;font-size:13px;padding:8px 0;transition:color 0.2s}
.sidebar-footer a:hover{color:#fff}

/* Main Content */
.main{flex:1;margin-left:260px;display:flex;flex-direction:column;height:100vh}
.main-header{padding:16px 24px;border-bottom:1px solid #222;display:flex;align-items:center;justify-content:space-between}
.model-select{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#1a1a1a;border:1px solid #333;border-radius:8px;color:#fff;font-size:14px}
.model-select select{background:transparent;border:none;color:#fff;font-size:14px;cursor:pointer;outline:none}
.model-select option{background:#1a1a1a}
.menu-btn{display:none;padding:8px 12px;background:transparent;border:1px solid #333;border-radius:8px;color:#fff;cursor:pointer}

/* Chat Area */
.chat-container{flex:1;overflow-y:auto;padding:24px}
.chat-messages{max-width:800px;margin:0 auto}

/* Welcome Screen */
.welcome{text-align:center;padding:60px 24px}
.welcome-logo{width:80px;height:80px;background:linear-gradient(135deg,#3fb950,#1a7f37);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:36px}
.welcome h1{font-size:32px;margin-bottom:12px}
.welcome h1 span{color:#3fb950}
.welcome p{color:#888;font-size:16px;margin-bottom:40px}
.suggestions{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;max-width:600px;margin:0 auto}
.suggestion{padding:16px;background:#1a1a1a;border:1px solid #333;border-radius:12px;cursor:pointer;text-align:left;transition:all 0.2s}
.suggestion:hover{border-color:#3fb950;background:#1f1f1f}
.suggestion-title{font-size:14px;font-weight:500;margin-bottom:4px}
.suggestion-desc{font-size:12px;color:#888}

/* Messages */
.message{display:flex;gap:16px;padding:24px 0;border-bottom:1px solid #1a1a1a}
.message:last-child{border-bottom:none}
.message-avatar{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px}
.message-avatar.user{background:#3fb950;color:#000}
.message-avatar.ai{background:#1a1a1a;border:1px solid #333}
.message-content{flex:1;line-height:1.7}
.message-content p{margin-bottom:12px}
.message-content p:last-child{margin-bottom:0}
.message-content code{background:#1a1a1a;padding:2px 6px;border-radius:4px;font-family:'Courier New',monospace;font-size:14px}
.message-content pre{background:#1a1a1a;padding:16px;border-radius:8px;overflow-x:auto;margin:12px 0}
.message-content pre code{background:transparent;padding:0}
.message-content ul,.message-content ol{margin:12px 0;padding-left:24px}
.message-content li{margin-bottom:8px}
.error-msg{color:#ff6b6b;background:rgba(255,107,107,0.1);padding:12px;border-radius:8px;border:1px solid rgba(255,107,107,0.2)}

/* Typing Indicator */
.typing{display:flex;gap:4px;padding:8px 0}
.typing span{width:8px;height:8px;background:#3fb950;border-radius:50%;animation:typing 1.4s infinite}
.typing span:nth-child(2){animation-delay:0.2s}
.typing span:nth-child(3){animation-delay:0.4s}
@keyframes typing{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}

/* Input Area */
.input-area{padding:16px 24px;border-top:1px solid #222;background:#0a0a0a}
.input-container{max-width:800px;margin:0 auto;position:relative}
.input-box{display:flex;align-items:flex-end;background:#1a1a1a;border:1px solid #333;border-radius:16px;padding:12px 16px;transition:border-color 0.2s}
.input-box:focus-within{border-color:#3fb950}
.input-box textarea{flex:1;background:transparent;border:none;color:#fff;font-size:15px;font-family:inherit;resize:none;outline:none;max-height:200px;line-height:1.5}
.input-box textarea::placeholder{color:#666}
.send-btn{width:36px;height:36px;background:#3fb950;border:none;border-radius:8px;color:#000;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;margin-left:8px}
.send-btn:hover{background:#4cc95f}
.send-btn:disabled{background:#333;color:#666;cursor:not-allowed}
.input-hint{text-align:center;padding:8px;font-size:12px;color:#666}

/* Mobile */
@media(max-width:768px){
  .sidebar{transform:translateX(-100%);z-index:100}
  .sidebar.open{transform:translateX(0)}
  .main{margin-left:0}
  .menu-btn{display:block}
  .overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:99}
  .overlay.show{display:block}
}
</style>
</head>
<body>

<!-- API Key Modal -->
<div class="modal" id="apiModal">
  <div class="modal-content">
    <h2><i class="fas fa-key"></i> Enter API Key</h2>
    <p>To use BLSC AI with real AI capabilities, enter your Google Gemini API key. It's free!</p>
    <input type="password" id="apiKeyInput" placeholder="Enter your Gemini API key...">
    <div class="btn-row">
      <button class="btn-secondary" onclick="closeModal()">Use Offline Mode</button>
      <button class="btn-primary" onclick="saveApiKey()">Connect AI</button>
    </div>
    <div class="help-text">
      <p>üìå Get your free API key from: <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></p>
      <p>üîí Your API key is stored locally and never shared.</p>
    </div>
  </div>
</div>

<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <button class="new-chat-btn" onclick="newChat()">
      <i class="fas fa-plus"></i> New Chat
    </button>
    <div class="api-status disconnected" id="apiStatus" onclick="showApiModal()">
      <i class="fas fa-circle"></i> <span>Offline Mode</span>
    </div>
  </div>
  <div class="chat-history" id="chatHistory">
    <div class="chat-item active"><i class="fas fa-message"></i> New conversation</div>
  </div>
  <div class="sidebar-footer">
    <a href="../../index.html"><i class="fas fa-arrow-left"></i> Back to BLSC</a>
    <a href="#" onclick="showApiModal()"><i class="fas fa-key"></i> API Settings</a>
    <a href="#" onclick="clearHistory()"><i class="fas fa-trash"></i> Clear conversations</a>
  </div>
</aside>

<main class="main">
  <header class="main-header">
    <button class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <div class="model-select">
      <i class="fas fa-robot"></i>
      <select id="modelSelect">
        <option value="gemini-1.5-flash">Gemini 1.5 Flash (Fast)</option>
        <option value="gemini-1.5-pro">Gemini 1.5 Pro (Smart)</option>
      </select>
    </div>
  </header>

  <div class="chat-container" id="chatContainer">
    <div class="chat-messages" id="chatMessages">
      <div class="welcome" id="welcome">
        <div class="welcome-logo"><i class="fas fa-robot"></i></div>
        <h1>Welcome to <span>BLSC AI</span></h1>
        <p>Powered by Google Gemini - Ask me anything!</p>
        <div class="suggestions">
          <div class="suggestion" onclick="askSuggestion('Explain quantum computing in simple terms')">
            <div class="suggestion-title">üî¨ Quantum Computing</div>
            <div class="suggestion-desc">Explain it simply</div>
          </div>
          <div class="suggestion" onclick="askSuggestion('Write a Python function to sort a list')">
            <div class="suggestion-title">üêç Write Python code</div>
            <div class="suggestion-desc">Sorting function</div>
          </div>
          <div class="suggestion" onclick="askSuggestion('What are the best practices for web security?')">
            <div class="suggestion-title">üîí Web Security</div>
            <div class="suggestion-desc">Best practices</div>
          </div>
          <div class="suggestion" onclick="askSuggestion('Create a business plan outline for a tech startup')">
            <div class="suggestion-title">üíº Business Plan</div>
            <div class="suggestion-desc">Tech startup</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="input-area">
    <div class="input-container">
      <div class="input-box">
        <textarea id="userInput" placeholder="Message BLSC AI..." rows="1" onkeydown="handleKeyDown(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
      </div>
      <div class="input-hint">BLSC AI powered by Google Gemini. Your conversations are private.</div>
    </div>
  </div>
</main>

<script>
let chatHistory = [];
let conversationHistory = [];
let isTyping = false;
let apiKey = localStorage.getItem('blsc_gemini_key') || '';

// System prompt for BLSC AI
const systemPrompt = `You are BLSC AI, an intelligent assistant created by BENAYAS LEULSEGED Software Company (BLSC), a technology company based in Jimma, Ethiopia. 

You are helpful, friendly, and knowledgeable. You can:
- Answer any questions on any topic
- Write code in any programming language
- Explain complex concepts simply
- Help with creative writing
- Provide advice and suggestions
- Have natural conversations

Always be helpful, accurate, and friendly. If you don't know something, say so honestly. Format your responses nicely with markdown when appropriate (use **bold**, \`code\`, and code blocks with \`\`\`).`;

// Check API key on load
function checkApiKey() {
  if (apiKey) {
    updateApiStatus(true);
  } else {
    showApiModal();
  }
}

function showApiModal() {
  document.getElementById('apiModal').classList.add('show');
  document.getElementById('apiKeyInput').value = apiKey;
}

function closeModal() {
  document.getElementById('apiModal').classList.remove('show');
}

function saveApiKey() {
  const key = document.getElementById('apiKeyInput').value.trim();
  if (key) {
    apiKey = key;
    localStorage.setItem('blsc_gemini_key', key);
    updateApiStatus(true);
    closeModal();
  } else {
    alert('Please enter a valid API key');
  }
}

function updateApiStatus(connected) {
  const status = document.getElementById('apiStatus');
  if (connected) {
    status.className = 'api-status connected';
    status.innerHTML = '<i class="fas fa-circle"></i> <span>AI Connected</span>';
  } else {
    status.className = 'api-status disconnected';
    status.innerHTML = '<i class="fas fa-circle"></i> <span>Offline Mode</span>';
  }
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('show');
}

function newChat() {
  chatHistory = [];
  conversationHistory = [];
  const welcomeHTML = `
    <div class="welcome" id="welcome">
      <div class="welcome-logo"><i class="fas fa-robot"></i></div>
      <h1>Welcome to <span>BLSC AI</span></h1>
      <p>Powered by Google Gemini - Ask me anything!</p>
      <div class="suggestions">
        <div class="suggestion" onclick="askSuggestion('Explain quantum computing in simple terms')">
          <div class="suggestion-title">üî¨ Quantum Computing</div>
          <div class="suggestion-desc">Explain it simply</div>
        </div>
        <div class="suggestion" onclick="askSuggestion('Write a Python function to sort a list')">
          <div class="suggestion-title">üêç Write Python code</div>
          <div class="suggestion-desc">Sorting function</div>
        </div>
        <div class="suggestion" onclick="askSuggestion('What are the best practices for web security?')">
          <div class="suggestion-title">üîí Web Security</div>
          <div class="suggestion-desc">Best practices</div>
        </div>
        <div class="suggestion" onclick="askSuggestion('Create a business plan outline for a tech startup')">
          <div class="suggestion-title">üíº Business Plan</div>
          <div class="suggestion-desc">Tech startup</div>
        </div>
      </div>
    </div>
  `;
  document.getElementById('chatMessages').innerHTML = welcomeHTML;
  if (document.getElementById('sidebar').classList.contains('open')) {
    toggleSidebar();
  }
}

function clearHistory() {
  if(confirm('Clear all conversations?')) {
    newChat();
  }
}

function autoResize(textarea) {
  textarea.style.height = 'auto';
  textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
}

function handleKeyDown(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function askSuggestion(text) {
  document.getElementById('userInput').value = text;
  sendMessage();
}

function addMessage(content, isUser, isError = false) {
  const welcome = document.getElementById('welcome');
  if (welcome) welcome.style.display = 'none';
  
  const messagesDiv = document.getElementById('chatMessages');
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message';
  
  const avatar = isUser 
    ? '<div class="message-avatar user"><i class="fas fa-user"></i></div>'
    : '<div class="message-avatar ai"><i class="fas fa-robot" style="color:#3fb950"></i></div>';
  
  const contentClass = isError ? 'message-content error-msg' : 'message-content';
  
  messageDiv.innerHTML = `
    ${avatar}
    <div class="${contentClass}">${formatMessage(content)}</div>
  `;
  
  messagesDiv.appendChild(messageDiv);
  scrollToBottom();
}

function addTypingIndicator() {
  const messagesDiv = document.getElementById('chatMessages');
  const typingDiv = document.createElement('div');
  typingDiv.className = 'message';
  typingDiv.id = 'typingIndicator';
  typingDiv.innerHTML = `
    <div class="message-avatar ai"><i class="fas fa-robot" style="color:#3fb950"></i></div>
    <div class="message-content">
      <div class="typing"><span></span><span></span><span></span></div>
    </div>
  `;
  messagesDiv.appendChild(typingDiv);
  scrollToBottom();
}

function removeTypingIndicator() {
  const typing = document.getElementById('typingIndicator');
  if (typing) typing.remove();
}

function formatMessage(text) {
  // Convert markdown to HTML
  // Code blocks
  text = text.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
    return `<pre><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>`;
  });
  // Inline code
  text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
  // Bold
  text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  // Italic
  text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
  // Line breaks
  text = text.replace(/\n/g, '<br>');
  return text;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function scrollToBottom() {
  const container = document.getElementById('chatContainer');
  container.scrollTop = container.scrollHeight;
}

// Call Gemini API
async function callGeminiAPI(message) {
  const model = document.getElementById('modelSelect').value;
  const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
  
  // Build conversation with history
  const contents = [];
  
  // Add system instruction
  contents.push({
    role: 'user',
    parts: [{ text: systemPrompt }]
  });
  contents.push({
    role: 'model',
    parts: [{ text: 'I understand. I am BLSC AI, ready to help!' }]
  });
  
  // Add conversation history
  for (const msg of conversationHistory) {
    contents.push({
      role: msg.role === 'user' ? 'user' : 'model',
      parts: [{ text: msg.content }]
    });
  }
  
  // Add current message
  contents.push({
    role: 'user',
    parts: [{ text: message }]
  });
  
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      contents: contents,
      generationConfig: {
        temperature: 0.7,
        topK: 40,
        topP: 0.95,
        maxOutputTokens: 8192
      }
    })
  });
  
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error?.message || 'API request failed');
  }
  
  const data = await response.json();
  return data.candidates[0].content.parts[0].text;
}

// Offline fallback responses
function getOfflineResponse(message) {
  const lower = message.toLowerCase();
  
  if (lower.includes('hello') || lower.includes('hi')) {
    return "Hello! üëã I'm BLSC AI. I'm currently in offline mode. Please add your Gemini API key to unlock full AI capabilities!";
  }
  if (lower.includes('help')) {
    return "I'm BLSC AI! To use my full capabilities, please add your free Google Gemini API key. Click 'API Settings' in the sidebar to get started.";
  }
  
  return "I'm currently in offline mode with limited capabilities. To unlock full AI features that can answer any question, please add your free Google Gemini API key by clicking 'API Settings' in the sidebar.\n\n**Get your free key at:** https://makersuite.google.com/app/apikey";
}

async function sendMessage() {
  const input = document.getElementById('userInput');
  const message = input.value.trim();
  
  if (!message || isTyping) return;
  
  // Add user message
  addMessage(message, true);
  conversationHistory.push({ role: 'user', content: message });
  
  // Clear input
  input.value = '';
  input.style.height = 'auto';
  
  // Show typing indicator
  isTyping = true;
  addTypingIndicator();
  
  try {
    let response;
    
    if (apiKey) {
      // Use Gemini API
      response = await callGeminiAPI(message);
    } else {
      // Offline mode
      await new Promise(r => setTimeout(r, 1000));
      response = getOfflineResponse(message);
    }
    
    removeTypingIndicator();
    addMessage(response, false);
    conversationHistory.push({ role: 'assistant', content: response });
    
  } catch (error) {
    removeTypingIndicator();
    addMessage(`**Error:** ${error.message}\n\nPlease check your API key and try again.`, false, true);
    updateApiStatus(false);
  }
  
  isTyping = false;
}

// Initialize
checkApiKey();
document.getElementById('userInput').focus();
</script>
</body>
</html>
