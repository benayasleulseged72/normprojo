<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLSC Admin Panel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:#0a0a0a;min-height:100vh;color:#fff}
        .bg-gradient{position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 20% 20%,rgba(63,185,80,0.15) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(88,166,255,0.1) 0%,transparent 50%),#0a0a0a;z-index:-1}
        
        /* Login Screen */
        .login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
        .login-box{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:24px;padding:40px;width:100%;max-width:400px;text-align:center}
        .login-box h1{font-size:28px;margin-bottom:8px}
        .login-box h1 span{color:#3fb950}
        .login-box p{color:rgba(255,255,255,0.5);margin-bottom:30px;font-size:14px}
        .login-box .icon{font-size:60px;margin-bottom:20px}
        .form-group{margin-bottom:20px;text-align:left}
        .form-group label{display:block;color:rgba(255,255,255,0.7);font-size:14px;margin-bottom:8px}
        .form-group input{width:100%;padding:14px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;color:#fff;font-size:15px}
        .form-group input:focus{outline:none;border-color:#3fb950}
        .login-btn{width:100%;padding:16px;background:linear-gradient(135deg,#3fb950,#2ea043);border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s}
        .login-btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(63,185,80,0.3)}
        .error-msg{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#ef4444;padding:12px;border-radius:10px;margin-bottom:20px;font-size:14px;display:none}
        
        /* Admin Panel */
        .admin-panel{display:none;padding:20px;max-width:1400px;margin:0 auto}
        .admin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:20px}
        .admin-header h1{font-size:28px}
        .admin-header h1 span{color:#3fb950}
        .logout-btn{padding:12px 24px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:100px;color:#ef4444;font-size:14px;cursor:pointer;transition:all 0.3s}
        .logout-btn:hover{background:rgba(239,68,68,0.2)}
        
        /* Stats */
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
        .stat-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:24px;text-align:center}
        .stat-card .number{font-size:42px;font-weight:800;color:#3fb950}
        .stat-card .label{color:rgba(255,255,255,0.5);font-size:14px;margin-top:8px}
        
        /* Tabs */
        .tabs{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
        .tab{padding:12px 24px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:100px;color:rgba(255,255,255,0.7);font-size:14px;cursor:pointer;transition:all 0.3s}
        .tab:hover{background:rgba(255,255,255,0.1)}
        .tab.active{background:#3fb950;color:#000;border-color:#3fb950}
        
        /* Content Panels */
        .content-panel{display:none}
        .content-panel.active{display:block}
        
        /* Users Table */
        .users-table{width:100%;border-collapse:collapse;background:rgba(255,255,255,0.03);border-radius:16px;overflow:hidden}
        .users-table th,.users-table td{padding:16px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.05)}
        .users-table th{background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.7);font-weight:600;font-size:13px;text-transform:uppercase}
        .users-table td{font-size:14px}
        .users-table tr:hover{background:rgba(255,255,255,0.02)}
        
        .user-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:14px}
        .user-info{display:flex;align-items:center;gap:12px}
        .user-name{font-weight:600}
        .user-email{color:rgba(255,255,255,0.5);font-size:13px}
        
        .badge{padding:4px 12px;border-radius:100px;font-size:12px;font-weight:600}
        .badge.active{background:rgba(63,185,80,0.15);color:#3fb950}
        .badge.expired{background:rgba(239,68,68,0.15);color:#ef4444}
        .badge.none{background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.5)}
        
        .action-btn{padding:8px 16px;border-radius:8px;font-size:13px;cursor:pointer;transition:all 0.3s;margin-right:8px;border:none}
        .action-btn.primary{background:#3fb950;color:#000}
        .action-btn.danger{background:rgba(239,68,68,0.2);color:#ef4444}
        .action-btn:hover{transform:scale(1.05)}
        
        /* Subscription Form */
        .sub-form{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:24px;margin-bottom:24px}
        .sub-form h3{margin-bottom:20px;font-size:18px}
        .sub-form .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:16px}
        .sub-form select{width:100%;padding:14px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;color:#fff;font-size:15px}
        .sub-form select option{background:#1a1a1a}
        
        /* Search */
        .search-box{margin-bottom:20px}
        .search-box input{width:100%;max-width:400px;padding:14px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:100px;color:#fff;font-size:15px}
        .search-box input:focus{outline:none;border-color:#3fb950}
        
        /* Responsive */
        @media(max-width:768px){
            .users-table{display:block;overflow-x:auto}
            .admin-header{flex-direction:column;text-align:center}
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="icon">üîê</div>
            <h1>BLSC <span>Admin</span></h1>
            <p>Enter admin credentials to access the control panel</p>
            <div class="error-msg" id="errorMsg">Invalid credentials</div>
            <form onsubmit="adminLogin(event)">
                <div class="form-group">
                    <label>Username / Email</label>
                    <input type="text" id="adminUser" placeholder="Enter username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="adminPass" placeholder="Enter password" required>
                </div>
                <button type="submit" class="login-btn">üîì Login to Admin Panel</button>
            </form>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h1>üõ°Ô∏è BLSC <span>Admin Panel</span></h1>
            <button class="logout-btn" onclick="adminLogout()">üö™ Logout</button>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="number" id="totalUsers">0</div>
                <div class="label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="number" id="activeTrials">0</div>
                <div class="label">Active Trials</div>
            </div>
            <div class="stat-card">
                <div class="number" id="paidSubs">0</div>
                <div class="label">Paid Subscriptions</div>
            </div>
            <div class="stat-card">
                <div class="number" id="expiredSubs">0</div>
                <div class="label">Expired</div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('users')">üë• All Users</button>
            <button class="tab" onclick="showTab('payments')">üí∞ Pending Payments</button>
            <button class="tab" onclick="showTab('subscriptions')">üí≥ Manage Subscriptions</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
        </div>
        
        <!-- Users Panel -->
        <div class="content-panel active" id="usersPanel">
            <div class="search-box">
                <input type="text" id="searchUsers" placeholder="üîç Search users by name or email..." oninput="filterUsers()">
            </div>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Created</th>
                        <th>Last Login</th>
                        <th>Subscriptions</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <tr><td colspan="5" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Loading users...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- Pending Payments Panel -->
        <div class="content-panel" id="paymentsPanel">
            <h3 style="margin-bottom:20px">üí∞ Pending Payment Requests</h3>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Service</th>
                        <th>Plan</th>
                        <th>Amount</th>
                        <th>Method</th>
                        <th>Phone</th>
                        <th>Screenshot</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="paymentsTableBody">
                    <tr><td colspan="9" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Loading...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- Screenshot Modal -->
        <div id="screenshotModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:9999;display:none;align-items:center;justify-content:center">
            <div style="max-width:90%;max-height:90%;position:relative">
                <button onclick="closeScreenshot()" style="position:absolute;top:-40px;right:0;background:#ef4444;border:none;color:#fff;padding:10px 20px;border-radius:8px;cursor:pointer">‚úï Close</button>
                <img id="modalScreenshot" style="max-width:100%;max-height:80vh;border-radius:12px;border:2px solid #3fb950">
            </div>
        </div>
        
        <!-- Subscriptions Panel -->
        <div class="content-panel" id="subscriptionsPanel">
            <div class="sub-form">
                <h3>‚ûï Add/Update Subscription</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>User Email</label>
                        <input type="email" id="subEmail" placeholder="user@email.com">
                    </div>
                    <div class="form-group">
                        <label>Service</label>
                        <select id="subService">
                            <option value="images">üîç Image Stock</option>
                            <option value="ai-image">üé® Image Generator</option>
                            <option value="ai-video">üé¨ Video Generator</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Plan Type</label>
                        <select id="subType">
                            <option value="free_trial">Free Trial (30 days)</option>
                            <option value="monthly">Monthly (30 days)</option>
                            <option value="yearly">Yearly (365 days)</option>
                            <option value="unlimited">Unlimited (Forever)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="action-btn primary" style="width:100%;padding:14px" onclick="addSubscription()">‚úÖ Activate Subscription</button>
                    </div>
                </div>
            </div>
            
            <h3 style="margin-bottom:16px">üìã All Subscriptions</h3>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Service</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Expires</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="subsTableBody">
                    <tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Loading...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- Settings Panel -->
        <div class="content-panel" id="settingsPanel">
            <div class="sub-form">
                <h3>‚öôÔ∏è Admin Settings</h3>
                <p style="color:rgba(255,255,255,0.5);margin-bottom:20px">Manage your admin account and system settings</p>
                
                <div class="form-group">
                    <label>Admin Email</label>
                    <input type="text" value="support@blsc.com" disabled style="opacity:0.5">
                </div>
                
                <div class="form-group">
                    <label>JSONBin.io Bin ID</label>
                    <input type="text" id="binId" value="" disabled style="opacity:0.5">
                </div>
                
                <button class="action-btn primary" onclick="refreshData()" style="margin-top:10px">üîÑ Refresh All Data</button>
                <button class="action-btn danger" onclick="exportAllData()" style="margin-top:10px">üì• Export All Data (JSON)</button>
            </div>
        </div>
    </div>

    <script src="blsc-account.js"></script>
    <script>
        // Admin credentials
        const ADMIN_USER = 'support@blsc.com';
        const ADMIN_PASS = '1xvbeni72';
        const ADMIN_SESSION_KEY = 'blsc_admin_session';
        
        let allUsers = {};
        
        // Check if already logged in
        function checkAdminSession() {
            const session = localStorage.getItem(ADMIN_SESSION_KEY);
            if (session === 'logged_in') {
                showAdminPanel();
            }
        }
        checkAdminSession();
        
        // Admin login
        function adminLogin(e) {
            e.preventDefault();
            const user = document.getElementById('adminUser').value;
            const pass = document.getElementById('adminPass').value;
            
            if ((user === ADMIN_USER || user === 'admin') && pass === ADMIN_PASS) {
                localStorage.setItem(ADMIN_SESSION_KEY, 'logged_in');
                showAdminPanel();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                setTimeout(() => document.getElementById('errorMsg').style.display = 'none', 3000);
            }
        }
        
        // Admin logout
        function adminLogout() {
            localStorage.removeItem(ADMIN_SESSION_KEY);
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        // Show admin panel
        async function showAdminPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('binId').value = BLSC_ACCOUNT.JSONBIN_BIN_ID;
            await loadAllData();
        }
        
        // Load all data from cloud
        async function loadAllData() {
            try {
                allUsers = await BLSC_ACCOUNT.getUsers();
                updateStats();
                renderUsersTable();
                renderSubscriptionsTable();
                renderPaymentsTable();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        // Update stats
        function updateStats() {
            const userList = Object.values(allUsers);
            let activeTrials = 0;
            let paidSubs = 0;
            let expired = 0;
            
            userList.forEach(user => {
                if (user.subscriptions) {
                    Object.values(user.subscriptions).forEach(sub => {
                        if (sub.type === 'unlimited') {
                            paidSubs++;
                        } else if (new Date() < new Date(sub.endDate)) {
                            if (sub.type === 'free_trial') activeTrials++;
                            else paidSubs++;
                        } else {
                            expired++;
                        }
                    });
                }
            });
            
            document.getElementById('totalUsers').textContent = userList.length;
            document.getElementById('activeTrials').textContent = activeTrials;
            document.getElementById('paidSubs').textContent = paidSubs;
            document.getElementById('expiredSubs').textContent = expired;
        }
        
        // Render users table
        function renderUsersTable(filter = '') {
            const tbody = document.getElementById('usersTableBody');
            const userList = Object.values(allUsers);
            
            if (userList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">No users found</td></tr>';
                return;
            }
            
            const filtered = filter ? userList.filter(u => 
                u.name.toLowerCase().includes(filter.toLowerCase()) || 
                u.email.toLowerCase().includes(filter.toLowerCase())
            ) : userList;
            
            tbody.innerHTML = filtered.map(user => {
                const color = BLSC_ACCOUNT.getAvatarColor(user.name);
                const initials = BLSC_ACCOUNT.getInitials(user.name);
                const subs = user.subscriptions ? Object.keys(user.subscriptions).length : 0;
                
                return `
                    <tr>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar" style="background:${color}">${initials}</div>
                                <div>
                                    <div class="user-name">${user.name}</div>
                                    <div class="user-email">${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never'}</td>
                        <td><span class="badge ${subs > 0 ? 'active' : 'none'}">${subs} service(s)</span></td>
                        <td>
                            <button class="action-btn primary" onclick="editUser('${user.email}')">‚úèÔ∏è Edit</button>
                            <button class="action-btn danger" onclick="deleteUser('${user.email}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Render subscriptions table
        function renderSubscriptionsTable() {
            const tbody = document.getElementById('subsTableBody');
            const rows = [];
            
            Object.values(allUsers).forEach(user => {
                if (user.subscriptions) {
                    Object.entries(user.subscriptions).forEach(([service, sub]) => {
                        const isActive = sub.type === 'unlimited' || new Date() < new Date(sub.endDate);
                        const serviceNames = {'images':'üîç Image Stock','ai-image':'üé® Image Generator','ai-video':'üé¨ Video Generator'};
                        
                        rows.push(`
                            <tr>
                                <td>${user.email}</td>
                                <td>${serviceNames[service] || service}</td>
                                <td>${sub.type}</td>
                                <td><span class="badge ${isActive ? 'active' : 'expired'}">${isActive ? 'Active' : 'Expired'}</span></td>
                                <td>${sub.endDate ? new Date(sub.endDate).toLocaleDateString() : 'Never'}</td>
                                <td>
                                    <button class="action-btn danger" onclick="removeSub('${user.email}','${service}')">üóëÔ∏è Remove</button>
                                </td>
                            </tr>
                        `);
                    });
                }
            });
            
            tbody.innerHTML = rows.length > 0 ? rows.join('') : '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">No subscriptions found</td></tr>';
        }
        
        // Filter users
        function filterUsers() {
            const filter = document.getElementById('searchUsers').value;
            renderUsersTable(filter);
        }
        
        // Show tab
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Panel').classList.add('active');
        }
        
        // Add subscription
        async function addSubscription() {
            const email = document.getElementById('subEmail').value;
            const service = document.getElementById('subService').value;
            const type = document.getElementById('subType').value;
            
            if (!email) {
                alert('Please enter user email');
                return;
            }
            
            if (!allUsers[email]) {
                alert('User not found: ' + email);
                return;
            }
            
            const days = {'free_trial':30,'monthly':30,'yearly':365,'unlimited':0};
            const result = await BLSC_ACCOUNT.activateSubscription(email, service, type, days[type]);
            
            if (result) {
                alert('‚úÖ Subscription activated for ' + email);
                await loadAllData();
            } else {
                alert('‚ùå Error activating subscription');
            }
        }
        
        // Remove subscription
        async function removeSub(email, service) {
            if (!confirm('Remove ' + service + ' subscription from ' + email + '?')) return;
            
            const users = await BLSC_ACCOUNT.getUsers();
            if (users[email] && users[email].subscriptions) {
                delete users[email].subscriptions[service];
                await BLSC_ACCOUNT.saveUsers(users);
                alert('‚úÖ Subscription removed');
                await loadAllData();
            }
        }
        
        // Delete user
        async function deleteUser(email) {
            if (!confirm('‚ö†Ô∏è Delete user ' + email + '? This cannot be undone!')) return;
            
            const users = await BLSC_ACCOUNT.getUsers();
            delete users[email];
            await BLSC_ACCOUNT.saveUsers(users);
            alert('‚úÖ User deleted');
            await loadAllData();
        }
        
        // Edit user (fill subscription form)
        function editUser(email) {
            document.getElementById('subEmail').value = email;
            showTab('subscriptions');
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.querySelectorAll('.tab')[0].classList.remove('active');
        }
        
        // Refresh data
        async function refreshData() {
            BLSC_ACCOUNT._usersCache = null;
            BLSC_ACCOUNT._cacheTime = null;
            await loadAllData();
            alert('‚úÖ Data refreshed from cloud');
        }
        
        // Export all data
        function exportAllData() {
            const data = JSON.stringify(allUsers, null, 2);
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'blsc_users_backup_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
        }
        
        // Render pending payments table with screenshot
        function renderPaymentsTable() {
            const tbody = document.getElementById('paymentsTableBody');
            const rows = [];
            const serviceNames = {'images':'üîç Image Stock','ai-image':'üé® Image Generator','ai-video':'üé¨ Video Generator'};
            
            Object.values(allUsers).forEach(user => {
                if (user.pendingPayments && user.pendingPayments.length > 0) {
                    user.pendingPayments.forEach((payment, index) => {
                        if (payment.status === 'pending') {
                            const hasScreenshot = payment.screenshotUrl ? 
                                `<button class="action-btn" style="background:#58a6ff;color:#fff" onclick="viewScreenshot('${payment.screenshotUrl.replace(/'/g, "\\'")}')">üì∑ View</button>` : 
                                '<span style="color:rgba(255,255,255,0.4)">No image</span>';
                            
                            rows.push(`
                                <tr>
                                    <td>${user.email}</td>
                                    <td>${serviceNames[payment.service] || payment.service}</td>
                                    <td>${payment.plan}</td>
                                    <td><strong>${payment.amount.toLocaleString()} Birr</strong></td>
                                    <td>${payment.method}</td>
                                    <td>${payment.senderPhone}</td>
                                    <td>${hasScreenshot}</td>
                                    <td>${new Date(payment.createdAt).toLocaleDateString()}</td>
                                    <td>
                                        <button class="action-btn primary" onclick="approvePayment('${user.email}',${index})">‚úÖ</button>
                                        <button class="action-btn danger" onclick="rejectPayment('${user.email}',${index})">‚ùå</button>
                                    </td>
                                </tr>
                            `);
                        }
                    });
                }
            });
            
            tbody.innerHTML = rows.length > 0 ? rows.join('') : '<tr><td colspan="9" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">No pending payments</td></tr>';
        }
        
        // View screenshot in modal
        function viewScreenshot(url) {
            document.getElementById('modalScreenshot').src = url;
            document.getElementById('screenshotModal').style.display = 'flex';
        }
        
        function closeScreenshot() {
            document.getElementById('screenshotModal').style.display = 'none';
        }
        
        // Close modal on click outside
        document.getElementById('screenshotModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeScreenshot();
        });
        
        // Approve payment and activate subscription
        async function approvePayment(email, paymentIndex) {
            const users = await BLSC_ACCOUNT.getUsers();
            const user = users[email];
            const payment = user.pendingPayments[paymentIndex];
            
            if (!confirm(`Approve payment of ${payment.amount} Birr from ${email} for ${payment.service} (${payment.plan})?`)) return;
            
            // Activate subscription
            const days = {'monthly':30,'yearly':365,'unlimited':0};
            await BLSC_ACCOUNT.activateSubscription(email, payment.service, payment.plan, days[payment.plan]);
            
            // Mark payment as approved
            users[email].pendingPayments[paymentIndex].status = 'approved';
            users[email].pendingPayments[paymentIndex].approvedAt = new Date().toISOString();
            await BLSC_ACCOUNT.saveUsers(users);
            
            alert('‚úÖ Payment approved! Subscription activated for ' + email);
            await loadAllData();
        }
        
        // Reject payment
        async function rejectPayment(email, paymentIndex) {
            if (!confirm(`Reject payment from ${email}?`)) return;
            
            const users = await BLSC_ACCOUNT.getUsers();
            users[email].pendingPayments[paymentIndex].status = 'rejected';
            users[email].pendingPayments[paymentIndex].rejectedAt = new Date().toISOString();
            await BLSC_ACCOUNT.saveUsers(users);
            
            alert('‚ùå Payment rejected');
            await loadAllData();
        }
    </script>
</body>
</html>
